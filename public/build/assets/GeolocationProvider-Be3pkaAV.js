import{b as i,j as S}from"./app-C7jiRkjs.js";const g=i.createContext(void 0),n="user_geolocation",v=24;function P({children:a}){const[m,s]=i.useState({city:null,state:null,country:null,latitude:null,longitude:null,isLoading:!0,error:null,hasPermission:null}),f=async(e,o)=>{try{const t=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${o}&zoom=10&addressdetails=1`,{headers:{"User-Agent":"Boletea2026/1.0"}})).json();if(t&&t.address){const c=t.address.city||t.address.town||t.address.village||t.address.municipality||null,d=t.address.state||null,u=t.address.country||null,h={city:c,state:d,country:u,latitude:e,longitude:o,timestamp:Date.now()};localStorage.setItem(n,JSON.stringify(h)),s({city:c,state:d,country:u,latitude:e,longitude:o,isLoading:!1,error:null,hasPermission:!0})}}catch(r){console.error("Reverse geocoding error:",r),s(t=>({...t,isLoading:!1,error:"No se pudo obtener la ciudad"}))}},l=()=>{if(!navigator.geolocation){s(e=>({...e,isLoading:!1,error:"Geolocalización no disponible",hasPermission:!1}));return}navigator.geolocation.getCurrentPosition(e=>{const{latitude:o,longitude:r}=e.coords;f(o,r)},e=>{console.error("Geolocation error:",e);let o="No se pudo obtener la ubicación";e.code===e.PERMISSION_DENIED&&(o="Permiso de ubicación denegado"),s(r=>({...r,isLoading:!1,error:o,hasPermission:!1}))},{enableHighAccuracy:!1,timeout:1e4,maximumAge:0})},p=()=>{try{const e=localStorage.getItem(n);if(e){const o=JSON.parse(e),r=Date.now(),t=v*60*60*1e3;if(r-o.timestamp<t)return s({city:o.city,state:o.state,country:o.country,latitude:o.latitude,longitude:o.longitude,isLoading:!1,error:null,hasPermission:!0}),!0;localStorage.removeItem(n)}}catch(e){console.error("Error loading stored location:",e)}return!1},y=()=>{localStorage.removeItem(n),s(e=>({...e,isLoading:!0})),l()};return i.useEffect(()=>{p()||l()},[]),S.jsx(g.Provider,{value:{...m,refreshLocation:y},children:a})}function x(){const a=i.useContext(g);if(a===void 0)throw new Error("useGeolocation must be used within a GeolocationProvider");return a}export{P as G,x as u};
